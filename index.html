<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="author" content="Stephan Bourgeois">
  <meta name="description" content="Perceptual frequency response mesurement tool. License: GNU Affero GPL">
  <meta name="robots" content="noindex,nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frequency Response Test</title>
  <script src="./fili.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1 {
      text-align: left;
      color: #002e50;
      font-size: 1.2em;
    }
    .controls {
      background-color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }
    .slider-container {
      margin: 15px 0;
    }
    .slider-container label {
      font-weight: bold;
      margin: 0;
    }
    .label-value-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .slider-value {
      font-size: 11pt;
      min-width: 70px;
      text-align: right;
    }
    .slider-with-indicator {
        position: relative;
        width: 100%;
        padding-top: 8px;  /* Space for the indicator */
    }
    .peak-indicator {
        position: absolute;
        top: 0;
        height: 3px;
        background-color: #ff0000;
        opacity: 0.7;
        pointer-events: none;  /* Allow clicks to pass through */
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
    }
    input[type="range"] {
      width: 100%;
      vertical-align: middle;
    }
    datalist {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin: 5px 0;
    }
    datalist option {
      padding: 0;
      font-size: 10px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    .history {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .history h2 {
      margin-top: 0;
      color: #2c3e50;
    }
    .history pre {
      font-family: monospace;
      font-size: 9pt;
    }
    .history-item {
      margin: 8px 0;
      padding: 8px;
      background-color: #f9f9f9;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <!--<h1>Frequency Response Test</h1>-->
  
  <div class="controls">
    <h1>Frequency Test</h1>
    <div class="slider-container">
      <div class="label-value-row">
        <label for="frequency-slider">Center Frequency:</label>
        <span class="slider-value" id="frequency-value"></span>
      </div>
      <input type="range" id="frequency-slider" min="0" max="27" value="2" step="1" list="frequency-ticks">
      <datalist id="frequency-ticks">
        <!-- Will be populated by JavaScript -->
      </datalist>
    </div>
    
    <div class="slider-container">
      <div class="label-value-row">
        <label for="amplitude-slider">Amplitude:</label>
        <span class="slider-value" id="amplitude-value">0 dB</span>
      </div>
      <div class="slider-with-indicator">
        <div class="peak-indicator"></div>
        <input type="range" id="amplitude-slider" min="-18" max="12" value="0" step="1" list="amplitude-ticks">
        <datalist id="amplitude-ticks">
          <option value=-18 label="-18"></option>
          <option value=-12 label="-12"></option>
          <option value=-6 label="-6&nbsp;"></option>
          <option value=0 label="0&nbsp;&nbsp;"></option>
          <option value=6 label="6&nbsp">:</option>
          <option value=12 label="12"></option>
        </datalist>
      </div>
    </div>
    
    <div class="buttons">
      <button id="play-button">Play Audio</button>
      <button id="stop-button" disabled>Stop Audio</button>
      <button id="save-history">Save Table</button>
      <button>
        <label for="csv-file-input">Load Table</label>
        <input type="file" id="csv-file-input" accept="text/csv" style="display:none;"/>
      </button>
      <button onclick="location.href='#help'" type="button">Help</button>
    </div>
  </div>

  <div class="history">
    <h1>Frequency Response</h1>
    <canvas id="history-plot" width="500" height="250"></canvas>
    <h1>Amplitude Error</h1>
    <pre id="history-list"></pre>
  </div>

  <div class="history">
    <section id="help">
      <h1>Instructions</h1>
    </section>
    <p style="color:red;">WARNING: Clipping can occur when the amplitude slider is moved past the red bar. This can damage your speakers and your hearing when played at high volume.</p>

    <p>You will hear tones alternating with a reference at 500Hz. Your goal is to move the amplitude slider so that both tones appear of equal loudness. Move the frequency slider and try to cover all the values. If you miss a frequency, it will become apparent as a jump in the frequency response graph.</p>

    <p>At the extremes of low and high frequency you may not be able to apply a correction, either due to hearing loss, or performance of the headphones, and you can leave the slider on zero.</p>

    <p>This version outputs an error file that you can import into <a href="https://www.roomeqwizard.com/">Room EQ Wizard</a> to create an equaliser definition, as you would from a speaker/room response measurement.</p>

    <p>This tool is a much simplified variant of David Griesinger's <a href="http://www.davidgriesinger.com/">DGSonicFocus</a> application.</p>

    <p>Source code: <a href="https://github.com/stephanb2/percep-head-eq">GitHub</a>
    <p><a href="#">Top</a></p>
  </div>
  <script src="./iirfilter05.js"></script>
</body>
</html>
